---
icon: ri:direction-line
---

# æœåŠ¡å™¨è·¯ç”±

> Nitro æ”¯æŒæ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼Œè‡ªåŠ¨å°†æ–‡ä»¶æ˜ å°„åˆ° h3 è·¯ç”±ã€‚

## äº‹ä»¶å¤„ç†å™¨

[äº‹ä»¶å¤„ç†å™¨](https://h3.unjs.io/guide/event-handler) æ˜¯ä¸€ä¸ªåŠŸèƒ½ï¼Œå®ƒå°†ç»‘å®šåˆ°ä¸€ä¸ªè·¯ç”±ï¼Œå¹¶åœ¨è·¯ç”±è¢«è·¯ç”±å™¨åŒ¹é…åˆ°ä¸€ä¸ªè¾“å…¥è¯·æ±‚æ—¶æ‰§è¡Œã€‚

:read-more{to="https://h3.unjs.io/guide/event-handler"}

## æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

Nitro æ”¯æŒåŸºäºæ–‡ä»¶çš„ API è·¯ç”±ï¼ˆæ–‡ä»¶è‡ªåŠ¨æ˜ å°„åˆ° [h3 è·¯ç”±](https://h3.unjs.io/guide/router)ï¼‰ã€‚å®šä¹‰ä¸€ä¸ªè·¯ç”±åªéœ€è¦åœ¨ `api/` æˆ– `routes/` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚

æ¯ä¸ªæ–‡ä»¶åªèƒ½å®šä¹‰ä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œä½ å¯ä»¥ [å°† HTTP æ–¹æ³•é™„åŠ ](#specific-request-method) åˆ°æ–‡ä»¶åï¼Œä»¥å®šä¹‰ä¸€ä¸ªç‰¹å®šçš„è¯·æ±‚æ–¹æ³•ã€‚

```md
api/
  test.ts      <-- /api/test
routes/
  hello.get.ts     <-- GET /hello
  hello.post.ts    <-- POST /hello
nitro.config.ts
```

ä½ å¯ä»¥é€šè¿‡åˆ›å»ºå­ç›®å½•æ¥åµŒå¥—è·¯ç”±ã€‚

```md
routes/
  communities/
    index.get.ts
    index.post.ts
    [id]/
        index.get.ts
        index.post.ts
  hello.get.ts
  hello.post.ts
```

::note
å¦‚æœä½ ä½¿ç”¨ [Nuxt](https://nuxt.com)ï¼Œè¯·å°† `server/api/` å’Œ `server/routes/` ç§»åŠ¨åˆ°å…¶å®ƒåœ°æ–¹ã€‚
::

::tip
ä¸€äº›æä¾›å•†ï¼Œå¦‚ Vercelï¼Œä½¿ç”¨é¡¶çº§çš„ `api/` ç›®å½•ä½œä¸ºç‰¹æ€§ï¼Œå› æ­¤æ”¾ç½®åœ¨ `/api` ä¸­çš„è·¯ç”±å°†æ— æ³•å·¥ä½œã€‚
ä½ å¿…é¡»ä½¿ç”¨ `routes/api/`ã€‚
::

### ç®€å•è·¯ç”±

é¦–å…ˆï¼Œåœ¨ `routes/` æˆ– `api/` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶åå°†æˆä¸ºè·¯ç”±è·¯å¾„ã€‚

ç„¶åï¼Œå¯¼å‡ºä¸€ä¸ªç”¨ `defineEventHandler` åŒ…è£…çš„å‡½æ•°ï¼Œå½“è·¯ç”±åŒ¹é…æ—¶å°†è¢«æ‰§è¡Œã€‚

```ts [/api/test.ts]
export default defineEventHandler(() => {
  return { hello: 'API' }
})
```

### å¸¦å‚æ•°çš„è·¯ç”±

#### å•ä¸ªå‚æ•°

è¦å®šä¹‰å…·æœ‰å‚æ•°çš„è·¯ç”±ï¼Œè¯·ä½¿ç”¨ `[<param>]` è¯­æ³•ï¼Œå…¶ä¸­ `<param>` æ˜¯å‚æ•°çš„åç§°ã€‚è¯¥å‚æ•°å°†å¯åœ¨ `event.context.params` å¯¹è±¡ä¸­ä½¿ç”¨ï¼Œæˆ–ä½¿ç”¨æ¥è‡ª [unjs/h3](https://h3.unjs.io) çš„ `getRouterParam` å·¥å…·ã€‚

```ts [/routes/hello/[name\\].ts]
export default defineEventHandler(event => {
  const name = getRouterParam(event, 'name')

  return `Hello ${name}!`
})
```

è°ƒç”¨å¸¦å‚æ•°çš„è·¯ç”± `/hello/nitro`ï¼Œä½ å°†å¾—åˆ°ï¼š

```txt [Response]
Hello nitro!
```

#### å¤šä¸ªå‚æ•°

ä½ å¯ä»¥ä½¿ç”¨ `[<param1>]/[<param2>]` è¯­æ³•åœ¨ä¸€ä¸ªè·¯ç”±ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ä½  **ä¸èƒ½** åœ¨å•ä¸ªæ–‡ä»¶åæˆ–æ–‡ä»¶å¤¹ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ã€‚

```ts [/routes/hello/[name\\]/[age\\].ts]
export default defineEventHandler(event => {
  const name = getRouterParam(event, 'name')
  const age = getRouterParam(event, 'age')

  return `Hello ${name}! You are ${age} years old.`
})
```

#### æ•è·æ‰€æœ‰å‚æ•°

ä½ å¯ä»¥ä½¿ç”¨ `[...<param>]` è¯­æ³•æ•è· URL çš„æ‰€æœ‰å‰©ä½™éƒ¨åˆ†ã€‚è¿™å°†åŒ…æ‹¬å‚æ•°ä¸­çš„ `/`ã€‚

```ts [/routes/hello/[...name\\].ts]
export default defineEventHandler(event => {
  const name = getRouterParam(event, 'name')

  return `Hello ${name}!`
})
```

è°ƒç”¨å¸¦å‚æ•°çš„è·¯ç”± `/hello/nitro/is/hot`ï¼Œä½ å°†å¾—åˆ°ï¼š

```txt [Response]
Hello nitro/is/hot!
```

### ç‰¹å®šè¯·æ±‚æ–¹æ³•

ä½ å¯ä»¥å°† HTTP æ–¹æ³•é™„åŠ åˆ°æ–‡ä»¶åï¼Œä»¥å¼ºåˆ¶è·¯ç”±ä»…åŒ¹é…ç‰¹å®šçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ `hello.get.ts` åªä¼šåŒ¹é… `GET` è¯·æ±‚ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ æƒ³è¦çš„ HTTP æ–¹æ³•ã€‚

::code-group
```js [GET]
// routes/users/[id].get.ts
export default defineEventHandler(async (event) => {
  const id = getRouterParam(event, 'id')

  // åšä¸€äº›ä¸ id ç›¸å…³çš„æ“ä½œ

  return `User profile!`
})
```

```js [POST]
// routes/users.post.ts
export default defineEventHandler(async event => {
  const body = await readBody(event)

  // åšä¸€äº›ä¸ body ç›¸å…³çš„æ“ä½œï¼Œä¾‹å¦‚å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“

  return { updated: true }
})
```
::

### æ•è·æ‰€æœ‰è·¯ç”±

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„è·¯ç”±ï¼ŒåŒ¹é…æ‰€æœ‰æœªè¢«ä»»ä½•å…¶ä»–è·¯ç”±åŒ¹é…çš„è·¯ç”±ã€‚è¿™å¯¹äºåˆ›å»ºé»˜è®¤è·¯ç”±å¾ˆæœ‰ç”¨ã€‚

è¦åˆ›å»ºæ•è·æ‰€æœ‰è·¯ç”±ï¼Œåœ¨ `routes/` æˆ– `api/` ç›®å½•ä¸­æˆ–ä»»ä½•å­ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º `[...].ts` çš„æ–‡ä»¶ã€‚

```ts [/routes/[...\\].ts]
export default defineEventHandler(event => {
  const url = getRequestURL(event)

  return `Hello ${url}!`
})
```

### ç¯å¢ƒç‰¹å®šå¤„ç†ç¨‹åº

ä½ å¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶ååæ·»åŠ  `.dev`ã€`.prod` æˆ– `.prerender` åç¼€ï¼ŒæŒ‡å®šä»…åœ¨ç‰¹å®šæ„å»ºä¸­åŒ…å«çš„è·¯ç”±ï¼Œä¾‹å¦‚ï¼š`routes/test.get.dev.ts` æˆ– `routes/test.get.prod.ts`ã€‚

> [!TIP]
> ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ `handlers[]` é…ç½®çš„ç¼–ç¨‹æ³¨å†Œè·¯å¾„ï¼ŒæŒ‡å®šå¤šä¸ªç¯å¢ƒæˆ–ä½¿ç”¨é¢„è®¾åç§°ä½œä¸ºç¯å¢ƒã€‚


## ä¸­é—´ä»¶

Nitro è·¯ç”±ä¸­é—´ä»¶å¯ä»¥é’©å…¥è¯·æ±‚ç”Ÿå‘½å‘¨æœŸã€‚

::tip
ä¸­é—´ä»¶å¯ä»¥åœ¨è¯·æ±‚è¢«å¤„ç†ä¹‹å‰ä¿®æ”¹è¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¹‹åã€‚
::

:read-more{to="https://h3.unjs.io/guide/event-handler#middleware"}

ä¸­é—´ä»¶åœ¨ `middleware/` ç›®å½•å†…è‡ªåŠ¨æ³¨å†Œã€‚

```md
routes/
  hello.ts
middleware/
  auth.ts
  logger.ts
  ...
nitro.config.ts
```

### ç®€å•ä¸­é—´ä»¶

ä¸­é—´ä»¶çš„å®šä¹‰ä¸è·¯ç”±å¤„ç†ç¨‹åºå®Œå…¨ç›¸åŒï¼Œå”¯ä¸€çš„ä¾‹å¤–æ˜¯åœ¨äºå®ƒä»¬ä¸åº”è¿”å›ä»»ä½•å†…å®¹ã€‚
ä»ä¸­é—´ä»¶è¿”å›çš„å†…å®¹ä¼šåƒä»è¯·æ±‚è¿”å›ä¸€æ · - è¿”å›çš„å€¼å°†ä½œä¸ºå“åº”è¿”å›ï¼Œåç»­ä»£ç å°†ä¸å†è¿è¡Œã€‚

```ts [middleware/auth.ts]
export default defineEventHandler((event) => {
  // æ‰©å±•æˆ–ä¿®æ”¹äº‹ä»¶
  event.context.user = { name: 'Nitro' }
})
```

åœ¨ `middleware/` ç›®å½•ä¸­çš„ä¸­é—´ä»¶ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°æ‰€æœ‰è·¯ç”±ã€‚å¦‚æœä½ æƒ³ä¸ºç‰¹å®šè·¯ç”±æ³¨å†Œä¸­é—´ä»¶ï¼Œè¯·å‚è§ [å¯¹è±¡è¯­æ³•äº‹ä»¶å¤„ç†ç¨‹åº](https://h3.unjs.io/guide/event-handler#object-syntax)ã€‚

::note
ä»ä¸­é—´ä»¶è¿”å›ä»»ä½•å†…å®¹å°†å…³é—­è¯·æ±‚ï¼Œåº”é¿å…è¿™æ ·åšï¼ä»ä¸­é—´ä»¶è¿”å›çš„ä»»ä½•å€¼éƒ½ä¼šæˆä¸ºå“åº”ï¼Œå¹¶ä¸”åç»­ä»£ç ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½† **è¿™å¹¶ä¸æ¨èè¿™æ ·åšï¼**
::

### è·¯ç”±å…ƒä¿¡æ¯

ä½ å¯ä»¥åœ¨æ„å»ºæ—¶é€šè¿‡ `defineRouteMeta` å¾®åŠŸèƒ½åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±å¤„ç†ç¨‹åºå…ƒä¿¡æ¯ã€‚

> [!IMPORTANT]
> ğŸš§ æ­¤åŠŸèƒ½å½“å‰ä¸ºå®éªŒæ€§åŠŸèƒ½ã€‚

```ts [/api/test.ts]
defineRouteMeta({
  openAPI: {
    tags: ["test"],
    description: "Test route description",
    parameters: [{ in: "query", name: "test", required: true }],
  },
});

export default defineEventHandler(() => "OK");
```

::read-more{to="https://swagger.io/specification/v3/"}
æ­¤åŠŸèƒ½å½“å‰å¯ç”¨äºæŒ‡å®š OpenAPI å…ƒä¿¡æ¯ã€‚æœ‰å…³å¯ç”¨çš„ OpenAPI é€‰é¡¹ï¼Œè¯·å‚è§ swagger è§„èŒƒã€‚
::

### æ‰§è¡Œé¡ºåº

ä¸­é—´ä»¶æŒ‰ç›®å½•åˆ—è¡¨é¡ºåºæ‰§è¡Œã€‚

```md
middleware/
  auth.ts <-- ç¬¬ä¸€ä¸ª
  logger.ts <-- ç¬¬äºŒä¸ª
  ... <-- ç¬¬ä¸‰ä¸ª
```

ä½¿ç”¨æ•°å­—ä½œä¸ºå‰ç¼€æ¥æ§åˆ¶å®ƒä»¬çš„æ‰§è¡Œé¡ºåºã€‚

```md
middleware/
  1.logger.ts <-- ç¬¬ä¸€ä¸ª
  2.auth.ts <-- ç¬¬äºŒä¸ª
  3.... <-- ç¬¬ä¸‰ä¸ª
```
::note
è¯·è®°ä½ï¼Œæ–‡ä»¶åæŒ‰å­—ç¬¦ä¸²æ’åºï¼Œå› æ­¤ï¼Œå¦‚æœä½ æœ‰ 3 ä¸ªæ–‡ä»¶ `1.filename.ts`ã€`2.filename.ts` å’Œ `10.filename.ts`ï¼Œé‚£ä¹ˆ `10.filename.ts` å°†åœ¨ `1.filename.ts` ä¹‹åã€‚å¦‚æœä½ æœ‰è¶…è¿‡ 10 ä¸ªä¸­é—´ä»¶åœ¨åŒä¸€ç›®å½•ä¸­ï¼Œå¯ä»¥å°† `1-9` å‰ç¼€åŠ ä¸Š `0`ï¼Œæ¯”å¦‚ `01`ã€‚
::

### è¯·æ±‚è¿‡æ»¤

ä¸­é—´ä»¶åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šæ‰§è¡Œã€‚

åº”ç”¨è‡ªå®šä¹‰é€»è¾‘ï¼Œä»¥å°†å®ƒä»¬èŒƒå›´ç¼©å°åˆ°ç‰¹å®šæ¡ä»¶ã€‚

ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ URL ä¸ºç‰¹å®šè·¯ç”±åº”ç”¨ä¸­é—´ä»¶ï¼š

```ts [middleware/auth.ts]
export default defineEventHandler((event) => {
  // ä»…åœ¨ /auth è·¯ç”±æ‰§è¡Œ
  if (getRequestURL(event).pathname.startsWith('/auth')) {
    event.context.user = { name: 'Nitro' }
  }
})
```

## Error handling

You can use the [utilities available in H3](https://h3.unjs.io/guide/event-handler#error-handling) to handle errors in both routes and middlewares.

The way errors are sent back to the client depends on the route's path. For most routes `Content-Type` is set to `text/html` by default and a simple html error page is delievered. If the route starts with `/api/` (either because it is placed in `api/` or `routes/api/`) the default will change to `application/json` and a JSON object will be sent.

This behaviour can be overridden by some request properties (e.g.: `Accept` or `User-Agent` headers).

## è·¯ç”±è§„åˆ™

Nitro å…è®¸ä½ åœ¨é…ç½®çš„é¡¶å±‚ä¸ºæ¯ä¸ªè·¯ç”±æ·»åŠ é€»è¾‘ã€‚å®ƒå¯ä»¥ç”¨äºé‡å®šå‘ã€ä»£ç†ã€ç¼“å­˜å’Œå‘è·¯ç”±æ·»åŠ å¤´ä¿¡æ¯ã€‚

å®ƒæ˜¯ä»è·¯ç”±æ¨¡å¼ï¼ˆéµå¾ª [unjs/radix3](https://github.com/unjs/rou3/tree/radix3#route-matcher)ï¼‰åˆ°è·¯ç”±é€‰é¡¹çš„æ˜ å°„ã€‚

å½“è®¾ç½® `cache` é€‰é¡¹æ—¶ï¼ŒåŒ¹é…æ¨¡å¼çš„å¤„ç†ç¨‹åºå°†è‡ªåŠ¨åŒ…è£¹åœ¨ `defineCachedEventHandler` ä¸­ã€‚è¯·å‚è§ [ç¼“å­˜æŒ‡å—](/guide/cache) ä»¥äº†è§£æœ‰å…³æ­¤åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ã€‚

::note
`swr: true|number` æ˜¯ `cache: { swr: true, maxAge: number }` çš„ç®€å†™ã€‚
::

ä½ å¯ä»¥ä½¿ç”¨ `routeRules` é€‰é¡¹åœ¨ `nitro.config.ts` ä¸­è®¾ç½®è·¯ç”±è§„åˆ™ã€‚

::code-group
```ts [nitro.config.ts]
export default defineNitroConfig({
  routeRules: {
    '/blog/**': { swr: true },
    '/blog/**': { swr: 600 },
    '/blog/**': { static: true },
    '/blog/**': { cache: { /* ç¼“å­˜é€‰é¡¹ */ } },
    '/assets/**': { headers: { 'cache-control': 's-maxage=0' } },
    '/api/v1/**': { cors: true, headers: { 'access-control-allow-methods': 'GET' } },
    '/old-page': { redirect: '/new-page' },
    '/old-page/**': { redirect: '/new-page/**' },
    '/proxy/example': { proxy: 'https://example.com' },
    '/proxy/**': { proxy: '/api/**' },
  }
})
```
```ts [nuxt.config.ts]
export default defineNuxtConfig({
  routeRules: {
    '/blog/**': { swr: true },
    '/blog/**': { swr: 600 },
    '/blog/**': { static: true },
    '/blog/**': { cache: { /* ç¼“å­˜é€‰é¡¹ */ } },
    '/assets/**': { headers: { 'cache-control': 's-maxage=0' } },
    '/api/v1/**': { cors: true, headers: { 'access-control-allow-methods': 'GET' } },
    '/old-page': { redirect: '/new-page' },
    '/old-page/**': { redirect: '/new-page/**' },
    '/proxy/example': { proxy: 'https://example.com' },
    '/proxy/**': { proxy: '/api/**' },
  }
})
```
::
