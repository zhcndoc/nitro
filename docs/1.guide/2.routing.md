---
icon: ri:direction-line
---

# æœåŠ¡å™¨è·¯ç”±

> Nitro æ”¯æŒæ–‡ä»¶ç³»ç»Ÿè·¯ç”±ï¼Œè‡ªåŠ¨å°†æ–‡ä»¶æ˜ å°„åˆ° h3 è·¯ç”±ã€‚

## äº‹ä»¶å¤„ç†ç¨‹åº

ä¸€ä¸ª [äº‹ä»¶å¤„ç†ç¨‹åº](https://h3.zhcndoc.com/guide/event-handler) æ˜¯ä¸€ä¸ªå°†è¢«ç»‘å®šåˆ°è·¯ç”±çš„å‡½æ•°ï¼Œå½“è·¯ç”±è¢«è·¯ç”±å™¨åŒ¹é…æ—¶ï¼Œå°†åœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶æ‰§è¡Œã€‚

:read-more{to="https://h3.zhcndoc.com/guide/event-handler"}

## æ–‡ä»¶ç³»ç»Ÿè·¯ç”±

Nitro æ”¯æŒåŸºäºæ–‡ä»¶çš„ API è·¯ç”±ï¼ˆæ–‡ä»¶ä¼šè‡ªåŠ¨æ˜ å°„åˆ° [h3 è·¯ç”±](https://h3.zhcndoc.com/guide/router)ï¼‰ã€‚å®šä¹‰è·¯ç”±å°±åƒåœ¨ `server/api/` æˆ– `server/routes/` ç›®å½•å†…åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä¸€æ ·ç®€å•ã€‚

æ¯ä¸ªæ–‡ä»¶åªèƒ½å®šä¹‰ä¸€ä¸ªå¤„ç†ç¨‹åºï¼Œæ‚¨å¯ä»¥ [å°† HTTP æ–¹æ³•é™„åŠ ](#specific-request-method) åˆ°æ–‡ä»¶åï¼Œä»¥å®šä¹‰ç‰¹å®šçš„è¯·æ±‚æ–¹æ³•ã€‚

```md
server/
  api/
    test.ts      <-- /api/test
  routes/
    hello.get.ts     <-- GET /hello
    hello.post.ts    <-- POST /hello
nitro.config.ts
```

æ‚¨å¯ä»¥é€šè¿‡åˆ›å»ºå­ç›®å½•æ¥åµŒå¥—è·¯ç”±ã€‚

```md
server/
  routes/
    communities/
      index.get.ts
      index.post.ts
      [id]/
        index.get.ts
        index.post.ts
    hello.get.ts
    hello.post.ts
```

::tip
æœ‰äº›æä¾›å•†å¦‚ Vercel å°†é¡¶çº§ `/api/` ç›®å½•ä½œä¸ºç‰¹æ€§ä½¿ç”¨ï¼Œå› æ­¤æ”¾åœ¨ `/api` ä¸­çš„è·¯ç”±å°†æ— æ³•å·¥ä½œã€‚
æ‚¨éœ€è¦ä½¿ç”¨ `server/routes/api/`ã€‚
::

### ç®€å•è·¯ç”±

é¦–å…ˆï¼Œåœ¨ `server/routes/` æˆ– `server/api/` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚æ–‡ä»¶åå°†æ˜¯è·¯ç”±è·¯å¾„ã€‚

ç„¶åï¼Œå¯¼å‡ºä¸€ä¸ªç”¨ `defineEventHandler` åŒ…è£¹çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨è·¯ç”±åŒ¹é…æ—¶æ‰§è¡Œã€‚

```ts [server/api/test.ts]
export default defineEventHandler(() => {
  return { hello: 'API' }
})
```

### å¸¦å‚æ•°çš„è·¯ç”±

#### å•ä¸ªå‚æ•°

è¦å®šä¹‰å¸¦å‚æ•°çš„è·¯ç”±ï¼Œä½¿ç”¨ `[<param>]` è¯­æ³•ï¼Œå…¶ä¸­ `<param>` æ˜¯å‚æ•°çš„åç§°ã€‚å‚æ•°å°†å¯åœ¨ `event.context.params` å¯¹è±¡ä¸­æ‰¾åˆ°ï¼Œæˆ–ä½¿ç”¨æ¥è‡ª [h3](https://h3.zhcndoc.com/) çš„ `getRouterParam` å·¥å…·ã€‚

```ts [server/routes/hello/[name\\].ts]
export default defineEventHandler(event => {
  const name = getRouterParam(event, 'name')

  return `Hello ${name}!`
})
```

è°ƒç”¨å¸¦å‚æ•°çš„è·¯ç”± `/hello/nitro`ï¼Œæ‚¨å°†å¾—åˆ°ï¼š

```txt [Response]
Hello nitro!
```

#### å¤šä¸ªå‚æ•°

æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ `[<param1>]/[<param2>]` è¯­æ³•åœ¨è·¯ç”±ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ï¼Œå…¶ä¸­æ¯ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚æ‚¨ **ä¸èƒ½** åœ¨å•ä¸ªæ–‡ä»¶åçš„æ–‡ä»¶å¤¹ä¸­å®šä¹‰å¤šä¸ªå‚æ•°ã€‚

```ts [server/routes/hello/[name\\]/[age\\].ts]
export default defineEventHandler(event => {
  const name = getRouterParam(event, 'name')
  const age = getRouterParam(event, 'age')

  return `Hello ${name}! You are ${age} years old.`
})
```

#### æ•è·æ‰€æœ‰å‚æ•°

æ‚¨å¯ä»¥ä½¿ç”¨ `[...<param>]` è¯­æ³•æ•è· URL ä¸­å‰©ä½™çš„æ‰€æœ‰éƒ¨åˆ†ã€‚è¿™å°†åŒ…æ‹¬æ–œæ  `/` åœ¨å‚æ•°ä¸­ã€‚

```ts [server/routes/hello/[...name\\].ts]
export default defineEventHandler(event => {
  const name = getRouterParam(event, 'name')

  return `Hello ${name}!`
})
```

è°ƒç”¨å¸¦å‚æ•°çš„è·¯ç”± `/hello/nitro/is/hot`ï¼Œæ‚¨å°†å¾—åˆ°ï¼š

```txt [Response]
Hello nitro/is/hot!
```

### ç‰¹å®šè¯·æ±‚æ–¹æ³•

æ‚¨å¯ä»¥å°† HTTP æ–¹æ³•é™„åŠ åˆ°æ–‡ä»¶åï¼Œä»¥å¼ºåˆ¶è·¯ç”±ä»…åŒ¹é…ç‰¹å®šçš„ HTTP è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ `hello.get.ts` å°†ä»…åŒ¹é… `GET` è¯·æ±‚ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨æƒ³è¦çš„ HTTP æ–¹æ³•ã€‚

::code-group
```js [GET]
// server/routes/users/[id].get.ts
export default defineEventHandler(async (event) => {
  const id = getRouterParam(event, 'id')

  // å¯¹ id æ‰§è¡ŒæŸäº›æ“ä½œ

  return `ç”¨æˆ·èµ„æ–™ï¼`
})
```

```js [POST]
// server/routes/users.post.ts
export default defineEventHandler(async event => {
  const body = await readBody(event)

  // å¯¹ body æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä¾‹å¦‚å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“

  return { updated: true }
})
```
::

### æ•è·æ‰€æœ‰è·¯ç”±

æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„è·¯ç”±ï¼ŒåŒ¹é…æœªè¢«ä»»ä½•å…¶ä»–è·¯ç”±åŒ¹é…çš„æ‰€æœ‰è·¯ç”±ã€‚è¿™å¯¹äºåˆ›å»ºé»˜è®¤è·¯ç”±éå¸¸æœ‰ç”¨ã€‚

è¦åˆ›å»ºæ•è·æ‰€æœ‰è·¯ç”±ï¼Œè¯·åœ¨ `server/routes/` æˆ– `server/api/` ç›®å½•æˆ–ä»»ä½•å­ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º `[...].ts` çš„æ–‡ä»¶ã€‚

```ts [server/routes/[...\\].ts]
export default defineEventHandler(event => {
  const url = getRequestURL(event)

  return `Hello ${url}!`
})
```

### ç¯å¢ƒç‰¹å®šå¤„ç†ç¨‹åº

æ‚¨å¯ä»¥æŒ‡å®šä»…åœ¨ç‰¹å®šæ„å»ºä¸­åŒ…å«çš„è·¯ç”±ï¼Œé€šè¿‡åœ¨æ–‡ä»¶ååæ·»åŠ  `.dev`ã€`.prod` æˆ– `.prerender` åç¼€ï¼Œä¾‹å¦‚ï¼š`routes/test.get.dev.ts` æˆ– `routes/test.get.prod.ts`ã€‚

> [!TIP]
> æ‚¨å¯ä»¥é€šè¿‡ `handlers[]` é…ç½®çš„ç¨‹åºæ³¨å†Œä¸ºç¯å¢ƒæŒ‡å®šå¤šä¸ªç¯å¢ƒæˆ–é¢„è®¾åç§°ä½œä¸ºç¯å¢ƒã€‚

## ä¸­é—´ä»¶

Nitro è·¯ç”±ä¸­é—´ä»¶å¯ä»¥æŒ‚é’©åˆ°è¯·æ±‚ç”Ÿå‘½å‘¨æœŸä¸­ã€‚

::tip
ä¸­é—´ä»¶å¯ä»¥åœ¨è¯·æ±‚å¤„ç†å‰ä¿®æ”¹è¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¹‹åã€‚
::

:read-more{to="https://h3.zhcndoc.com/guide/event-handler#middleware"}

ä¸­é—´ä»¶åœ¨ `server/middleware/` ç›®å½•ä¸­è‡ªåŠ¨æ³¨å†Œã€‚

```md
server/
  routes/
    hello.ts
  middleware/
    auth.ts
    logger.ts
    ...
nitro.config.ts
```

### ç®€å•ä¸­é—´ä»¶

ä¸­é—´ä»¶ä¸è·¯ç”±å¤„ç†ç¨‹åºçš„å®šä¹‰æ–¹å¼å®Œå…¨ç›¸åŒï¼Œå”¯ä¸€ä¾‹å¤–æ˜¯å®ƒä»¬ä¸åº”è¿”å›ä»»ä½•å†…å®¹ã€‚
ä»ä¸­é—´ä»¶è¿”å›çš„è¡Œä¸ºç±»ä¼¼äºä»è¯·æ±‚è¿”å› - è¯¥å€¼å°†ä½œä¸ºå“åº”è¿”å›ï¼Œä¸”ä¸ä¼šæ‰§è¡Œåç»­ä»£ç ã€‚

```ts [server/middleware/auth.ts]
export default defineEventHandler((event) => {
  // æ‰©å±•æˆ–ä¿®æ”¹äº‹ä»¶
  event.context.user = { name: 'Nitro' }
})
```

åœ¨ `server/middleware/` ç›®å½•ä¸­çš„ä¸­é—´ä»¶ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°æ‰€æœ‰è·¯ç”±ã€‚å¦‚æœæ‚¨æƒ³ä¸ºç‰¹å®šè·¯ç”±æ³¨å†Œä¸­é—´ä»¶ï¼Œè¯·å‚è§ [å¯¹è±¡è¯­æ³•äº‹ä»¶å¤„ç†ç¨‹åº](https://h3.zhcndoc.com/guide/event-handler#object-syntax)ã€‚

::note
ä»ä¸­é—´ä»¶è¿”å›ä»»ä½•å†…å®¹å°†å…³é—­è¯·æ±‚ï¼Œåº”é¿å…ï¼ä»ä¸­é—´ä»¶è¿”å›çš„ä»»ä½•å€¼å°†æ˜¯å“åº”ï¼Œä¸”åç»­ä»£ç å°†ä¸è¢«æ‰§è¡Œï¼Œç„¶è€Œ **è¿™å¹¶ä¸æ¨èè¿™æ ·åšï¼**
::

### è·¯ç”±å…ƒæ•°æ®

æ‚¨å¯ä»¥åœ¨æ„å»ºæ—¶ä½¿ç”¨ `defineRouteMeta` å®åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±å¤„ç†ç¨‹åºçš„å…ƒæ•°æ®ã€‚

> [!IMPORTANT]
> ğŸš§ æ­¤åŠŸèƒ½å½“å‰å¤„äºå®éªŒé˜¶æ®µã€‚

```ts [server/api/test.ts]
defineRouteMeta({
  openAPI: {
    tags: ["test"],
    description: "æµ‹è¯•è·¯ç”±æè¿°",
    parameters: [{ in: "query", name: "test", required: true }],
  },
});

export default defineEventHandler(() => "OK");
```

::read-more{to="https://swagger.io/specification/v3/"}
æ­¤åŠŸèƒ½ç›®å‰å¯ç”¨äºæŒ‡å®š OpenAPI å…ƒæ•°æ®ã€‚æœ‰å…³å¯ç”¨çš„ OpenAPI é€‰é¡¹ï¼Œè¯·å‚è§ swagger è§„èŒƒã€‚
::

### æ‰§è¡Œé¡ºåº

ä¸­é—´ä»¶æŒ‰ç›®å½•åˆ—è¡¨é¡ºåºæ‰§è¡Œã€‚

```md
server/
  middleware/
    auth.ts <-- ç¬¬ä¸€ä¸ª
    logger.ts <-- ç¬¬äºŒä¸ª
    ... <-- ç¬¬ä¸‰ä¸ª
```

ç”¨æ•°å­—å‰ç¼€ä¸­é—´ä»¶ä»¥æ§åˆ¶å…¶æ‰§è¡Œé¡ºåºã€‚

```md
server/
  middleware/
    1.logger.ts <-- ç¬¬ä¸€ä¸ª
    2.auth.ts <-- ç¬¬äºŒä¸ª
    3.... <-- ç¬¬ä¸‰ä¸ª
```
::note
è¯·è®°ä½ï¼Œæ–‡ä»¶åæŒ‰å­—ç¬¦ä¸²æ’åºï¼Œå› æ­¤ä¾‹å¦‚å¦‚æœæ‚¨æœ‰ 3 ä¸ªæ–‡ä»¶ `1.filename.ts`ã€`2.filename.ts` å’Œ `10.filename.ts`ï¼Œåˆ™ `10.filename.ts` å°†åœ¨ `1.filename.ts` ä¹‹åå‡ºç°ã€‚ä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œå‰ç¼€ `1-9` æ—¶ä½¿ç”¨ `0`ï¼Œå¦‚ `01`ï¼Œå¦‚æœæ‚¨åœ¨åŒä¸€ç›®å½•ä¸­æœ‰è¶…è¿‡ 10 ä¸ªä¸­é—´ä»¶ã€‚
::

### è¯·æ±‚è¿‡æ»¤

ä¸­é—´ä»¶åœ¨æ¯ä¸ªè¯·æ±‚ä¸Šæ‰§è¡Œã€‚

åº”ç”¨è‡ªå®šä¹‰é€»è¾‘ï¼Œå°†å…¶ä½œç”¨åŸŸé™åˆ¶ä¸ºç‰¹å®šæ¡ä»¶ã€‚

ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ URL å°†ä¸­é—´ä»¶åº”ç”¨äºç‰¹å®šè·¯ç”±ï¼š

```ts [server/middleware/auth.ts]
export default defineEventHandler((event) => {
  // ä»…åœ¨ /auth è·¯ç”±æ‰§è¡Œ
  if (getRequestURL(event).pathname.startsWith('/auth')) {
    event.context.user = { name: 'Nitro' }
  }
})
```

## é”™è¯¯å¤„ç†

æ‚¨å¯ä»¥ä½¿ç”¨ [H3 ä¸­æä¾›çš„å·¥å…·](https://h3.zhcndoc.com/guide/event-handler#error-handling) æ¥å¤„ç†è·¯ç”±å’Œä¸­é—´ä»¶ä¸­çš„é”™è¯¯ã€‚

é”™è¯¯è¿”å›ç»™å®¢æˆ·ç«¯çš„æ–¹å¼å–å†³äºè·¯ç”±çš„è·¯å¾„ã€‚å¯¹äºå¤§å¤šæ•°è·¯ç”±ï¼Œ`Content-Type` é»˜è®¤è®¾ç½®ä¸º `text/html`ï¼Œå¹¶äº¤ä»˜ç®€å•çš„ HTML é”™è¯¯é¡µé¢ã€‚å¦‚æœè·¯ç”±ä»¥ `/api/` å¼€å¤´ï¼ˆå› ä¸ºå®ƒä½äº `api/` æˆ– `routes/api/` ä¸­ï¼‰ï¼Œé»˜è®¤å°†æ›´æ”¹ä¸º `application/json`ï¼Œå¹¶å‘é€ JSON å¯¹è±¡ã€‚

è¿™ç§è¡Œä¸ºå¯ä»¥è¢«æŸäº›è¯·æ±‚å±æ€§ï¼ˆä¾‹å¦‚ï¼š`Accept` æˆ– `User-Agent` å¤´ï¼‰è¦†ç›–ã€‚

## è·¯ç”±è§„åˆ™

Nitro å…è®¸æ‚¨åœ¨é…ç½®çš„é¡¶å±‚ä¸ºæ¯ä¸ªè·¯ç”±æ·»åŠ é€»è¾‘ã€‚è¿™å¯ä»¥ç”¨äºé‡å®šå‘ã€ä»£ç†ã€ç¼“å­˜å’Œä¸ºè·¯ç”±æ·»åŠ å¤´ã€‚

å®ƒæ˜¯ä»è·¯ç”±æ¨¡å¼ï¼ˆéµå¾ª [rou3](https://github.com/h3js/rou3)ï¼‰åˆ°è·¯ç”±é€‰é¡¹çš„æ˜ å°„ã€‚

å½“ `cache` é€‰é¡¹è®¾ç½®æ—¶ï¼ŒåŒ¹é…æ¨¡å¼çš„å¤„ç†ç¨‹åºå°†è‡ªåŠ¨åŒ…è£¹åœ¨ `defineCachedEventHandler` ä¸­ã€‚æœ‰å…³æ­¤åŠŸèƒ½çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ [ç¼“å­˜æŒ‡å—](/guide/cache)ã€‚

::note
`swr: true|number` æ˜¯ `cache: { swr: true, maxAge: number }` çš„å¿«æ·æ–¹å¼ã€‚
::

æ‚¨å¯ä»¥åœ¨ `nitro.config.ts` ä¸­ä½¿ç”¨ `routeRules` é€‰é¡¹è®¾ç½®è·¯ç”±è§„åˆ™ã€‚

::code-group
```ts [nitro.config.ts]
export default defineNitroConfig({
  routeRules: {
    '/blog/**': { swr: true },
    '/blog/**': { swr: 600 },
    '/blog/**': { static: true },
    '/blog/**': { cache: { /* ç¼“å­˜é€‰é¡¹ */ } },
    '/assets/**': { headers: { 'cache-control': 's-maxage=0' } },
    '/api/v1/**': { cors: true, headers: { 'access-control-allow-methods': 'GET' } },
    '/old-page': { redirect: '/new-page' },
    '/old-page/**': { redirect: '/new-page/**' },
    '/proxy/example': { proxy: 'https://example.com' },
    '/proxy/**': { proxy: '/api/**' },
  }
})
```
```ts [nuxt.config.ts]
export default defineNuxtConfig({
  routeRules: {
    '/blog/**': { swr: true },
    '/blog/**': { swr: 600 },
    '/blog/**': { static: true },
    '/blog/**': { cache: { /* ç¼“å­˜é€‰é¡¹ */ } },
    '/assets/**': { headers: { 'cache-control': 's-maxage=0' } },
    '/api/v1/**': { cors: true, headers: { 'access-control-allow-methods': 'GET' } },
    '/old-page': { redirect: '/new-page' },
    '/old-page/**': { redirect: '/new-page/**' },
    '/proxy/example': { proxy: 'https://example.com' },
    '/proxy/**': { proxy: '/api/**' },
  }
})
```
::
