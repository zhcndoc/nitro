import{a9 as L,d as le,aV as se,aW as ue,aX as oe,aY as X,o as q,c as D,w as $,k as R,l as h,P as te,aZ as j,a_ as O,r as ae,a$ as de,b0 as ce,m as w,b1 as fe,q as ve,b2 as U,b3 as pe,g as ge,O as ne,b4 as Y,S as he,a as me,aJ as ye,a7 as F,a8 as be,t as P,L as J,M as xe,x as M,V as E,aa as ke,$ as Z,R as Ce,y as Q,X as ee}from"./CWSiIDVY.js";import{f as G}from"./Bt098Kap.js";import{R as Te}from"./Cl5uiQ5S.js";import Ke from"./DgeaJkb5.js";function Se(c,C){const e=L(),g=(l,A)=>{if(C.multiple&&Array.isArray(c.value))if(C.selectionBehavior==="replace")c.value=[l],e.value=l;else{const T=c.value.findIndex(r=>A(r));T!==-1?c.value=c.value.filter((r,x)=>x!==T):c.value=[...c.value,l]}else C.selectionBehavior==="replace"?c.value={...l}:!Array.isArray(c.value)&&A(c.value)?c.value=void 0:c.value={...l};return c.value};function V(l,A,T,r){if(!e?.value||!C.multiple||!Array.isArray(c.value))return;const k=T().filter(S=>S.ref.dataset.disabled!=="").find(S=>S.ref===A)?.value;if(!k)return;let K=null;switch(l){case"prev":case"next":{K=G(r,e.value,k);break}case"first":{K=G(r,e.value,r?.[0]);break}case"last":{K=G(r,e.value,r?.[r.length-1]);break}}c.value=K}return{firstValue:e,onSelectItem:g,handleMultipleReplace:V}}function W(c){return c.reduce((C,e)=>(C.push(e),e.children&&C.push(...W(e.children)),C),[])}const[Ae,Ie]=pe("TreeRoot");var _e=le({__name:"TreeRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},items:{type:Array,required:!1},expanded:{type:Array,required:!1},defaultExpanded:{type:Array,required:!1},getKey:{type:Function,required:!0},getChildren:{type:Function,required:!1,default:c=>c.children},selectionBehavior:{type:String,required:!1,default:"toggle"},multiple:{type:Boolean,required:!1,skipCheck:!0},dir:{type:String,required:!1},disabled:{type:Boolean,required:!1},propagateSelect:{type:Boolean,required:!1},bubbleSelect:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"ul"}},emits:["update:modelValue","update:expanded"],setup(c,{emit:C}){const e=c,g=C,{items:V,multiple:l,disabled:A,propagateSelect:T,dir:r,bubbleSelect:x}=se(e),{handleTypeaheadSearch:k}=ue(),K=oe(r),S=L(),_=L(!1),B=ce(),f=X(e,"modelValue",g,{defaultValue:e.defaultValue??(l.value?[]:void 0),passive:!0,deep:!0}),y=X(e,"expanded",g,{defaultValue:e.defaultExpanded??[],passive:e.expanded===void 0,deep:!0}),{onSelectItem:n,handleMultipleReplace:i}=Se(f,e),t=w(()=>l.value&&Array.isArray(f.value)?f.value.map(a=>e.getKey(a)):[e.getKey(f.value??{})]);function o(a,d=1,b){return a.reduce((p,I,N)=>{const H=e.getKey(I),z=e.getChildren(I),re=y.value.includes(H),ie={_id:H,value:I,index:N,level:d,parentItem:b,hasChildren:!!z,bind:{value:I,level:d,"aria-setsize":a.length,"aria-posinset":N+1}};return p.push(ie),z&&re&&p.push(...o(z,d+1,I)),p},[])}const s=w(()=>{const a=e.items;return y.value.map(d=>d),o(a??[])});function v(a){if(_.value)B.trigger(a);else{const d=S.value?.getItems()??[];k(a.key,d)}}function u(a){if(_.value)return;const d=fe[a.key];ve(()=>{i(d,U(),S.value?.getItems,s.value.map(b=>b.value))})}function m(a){if(a.parentItem!=null&&Array.isArray(f.value)&&e.multiple){const d=s.value.find(b=>a.parentItem!=null&&e.getKey(b.value)===e.getKey(a.parentItem));d!=null&&(e.getChildren(d.value)?.every(p=>f.value.find(I=>e.getKey(I)===e.getKey(p)))?f.value=[...f.value,d.value]:f.value=f.value.filter(p=>e.getKey(p)!==e.getKey(d.value)),m(d))}}return Ie({modelValue:f,selectedKeys:t,onSelect:a=>{const d=p=>e.getKey(p??{})===e.getKey(a),b=e.multiple&&Array.isArray(f.value)?f.value?.findIndex(d)!==-1:void 0;if(n(a,d),e.bubbleSelect&&e.multiple&&Array.isArray(f.value)){const p=s.value.find(I=>e.getKey(I.value)===e.getKey(a));p!=null&&m(p)}if(e.propagateSelect&&e.multiple&&Array.isArray(f.value)){const p=W(e.getChildren(a)??[]);b?f.value=[...f.value].filter(I=>!p.some(N=>e.getKey(I??{})===e.getKey(N))):f.value=[...f.value,...p]}},expanded:y,onToggle(a){if(!(a?e.getChildren(a):void 0))return;const b=e.getKey(a)??a;y.value.includes(b)?y.value=y.value.filter(p=>p!==b):y.value=[...y.value,b]},getKey:e.getKey,getChildren:e.getChildren,items:V,expandedItems:s,disabled:A,multiple:l,dir:K,propagateSelect:T,bubbleSelect:x,isVirtual:_,virtualKeydownHook:B,handleMultipleReplace:i}),(a,d)=>(q(),D(h(de),{ref_key:"rovingFocusGroupRef",ref:S,"as-child":"",orientation:"vertical",dir:h(K)},{default:$(()=>[R(h(te),{role:"tree",as:a.as,"as-child":a.asChild,"aria-multiselectable":h(l)?!0:void 0,onKeydown:[v,j(O(u,["shift"]),["up","down"])]},{default:$(()=>[ae(a.$slots,"default",{flattenItems:s.value,modelValue:h(f),expanded:h(y)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),Ee=_e;const qe="tree.select",we="tree.toggle";var Ve=le({inheritAttrs:!1,__name:"TreeItem",props:{value:{type:null,required:!0},level:{type:Number,required:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"li"}},emits:["select","toggle"],setup(c,{expose:C,emit:e}){const g=c,V=e,l=Ae(),{getItems:A}=ge(),T=w(()=>!!l.getChildren(g.value)),r=w(()=>{const n=l.getKey(g.value);return l.expanded.value.includes(n)}),x=w(()=>{const n=l.getKey(g.value);return l.selectedKeys.value.includes(n)}),k=w(()=>{if(l.bubbleSelect.value&&T.value&&Array.isArray(l.modelValue.value)){const n=W(l.getChildren(g.value)||[]);return n.some(i=>l.modelValue.value.find(t=>l.getKey(t)===l.getKey(i)))&&!n.every(i=>l.modelValue.value.find(t=>l.getKey(t)===l.getKey(i)))}else return l.propagateSelect.value&&x.value&&T.value&&Array.isArray(l.modelValue.value)?!W(l.getChildren(g.value)||[]).every(i=>l.modelValue.value.find(t=>l.getKey(t)===l.getKey(i))):void 0});function K(n){if(T.value)if(r.value){const i=A().map(u=>u.ref),t=U(),o=i.indexOf(t),v=[...i].slice(o).find(u=>Number(u.getAttribute("data-indent"))===g.level+1);v&&v.focus()}else y(n)}function S(n){if(r.value)y(n);else{const i=A().map(u=>u.ref),t=U(),o=i.indexOf(t),v=[...i].slice(0,o).reverse().find(u=>Number(u.getAttribute("data-indent"))===g.level-1);v&&v.focus()}}async function _(n){V("select",n),!n?.defaultPrevented&&l.onSelect(g.value)}async function B(n){V("toggle",n),!n?.defaultPrevented&&l.onToggle(g.value)}async function f(n){if(!n)return;const i={originalEvent:n,value:g.value,isExpanded:r.value,isSelected:x.value};Y(qe,_,i)}async function y(n){if(!n)return;const i={originalEvent:n,value:g.value,isExpanded:r.value,isSelected:x.value};Y(we,B,i)}return C({isExpanded:r,isSelected:x,isIndeterminate:k,handleToggle:()=>l.onToggle(g.value),handleSelect:()=>l.onSelect(g.value)}),(n,i)=>(q(),D(h(Te),{"as-child":"",value:n.value,"allow-shift-key":""},{default:$(()=>[R(h(te),ne(n.$attrs,{role:"treeitem",as:n.as,"as-child":n.asChild,"aria-selected":x.value,"aria-expanded":T.value?r.value:void 0,"aria-level":n.level,"data-indent":n.level,"data-selected":x.value?"":void 0,"data-expanded":r.value?"":void 0,onKeydown:[j(O(f,["self","prevent"]),["enter","space"]),i[0]||(i[0]=j(O(t=>h(l).dir.value==="ltr"?K(t):S(t),["prevent"]),["right"])),i[1]||(i[1]=j(O(t=>h(l).dir.value==="ltr"?S(t):K(t),["prevent"]),["left"]))],onClick:i[2]||(i[2]=O(t=>{f(t),y(t)},["stop"]))}),{default:$(()=>[ae(n.$slots,"default",{isExpanded:r.value,isSelected:x.value,isIndeterminate:k.value,handleSelect:()=>h(l).onSelect(n.value),handleToggle:()=>h(l).onToggle(n.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),Re=Ve;const Be={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},De=Object.assign({inheritAttrs:!1},{__name:"ProseCodeTree",props:{items:{type:Array,required:!1},modelValue:{type:String,required:!1},defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},emits:["update:modelValue"],setup(c,{emit:C}){const e=c,g=C,V=he(),l=me(),[A,T]=ye(),r=w(()=>ee({extend:ee(Be),...l.ui?.prose?.codeTree||{}})()),x=e.modelValue??e.defaultValue,k=L(x?{path:x}:void 0),K=L();F(k,t=>{t?.path!==e.modelValue&&g("update:modelValue",t?.path)}),F(()=>e.modelValue,t=>{if(t===k.value?.path)return;k.value=t?{path:t}:void 0;const o=n(t);for(const s of o)i.value.includes(s)||i.value.push(s)});const S=L(1),_=w(()=>(S.value,e.items||V.default?.()?.flatMap(y).filter(Boolean)||[])),B=w(()=>f(_.value));function f(t){const o=new Map,s=[];t.forEach(u=>{const m=u.label.split("/");let a="";m.forEach((d,b)=>{if(a=a?`${a}/${d}`:d,!o.has(a)){const p={label:d,path:a,...b<m.length-1&&{children:[]}};o.set(a,p),b===0?s.push(p):o.get(m.slice(0,b).join("/"))?.children?.push(p)}})});const v=u=>u.sort((m,a)=>!!m.children==!!a.children?m.label.localeCompare(a.label):a.children?1:-1).map(m=>({...m,children:m.children&&v(m.children)}));return v(s)}function y(t,o){return typeof t.type=="symbol"?t.children?.map(y):{label:t.props?.filename||t.props?.label||`${o}`,icon:t.props?.icon,component:t}}function n(t){if(e.expandAll){const s=new Set;return _.value.forEach(v=>{const u=v.label.split("/");for(let m=1;m<u.length;m++)s.add(u.slice(0,m).join("/"))}),Array.from(s)}if(!t)return[];const o=t.split("/");return o.slice(0,-1).map((s,v)=>o.slice(0,v+1).join("/"))}const i=L(n(k.value?.path));return F(_,(t,o)=>{if(!e.expandAll)return;const s=t.map(u=>u.label).join(`
`),v=o?.map(u=>u.label).join(`
`)??"";s!==v&&(i.value=n())}),F(k,t=>{const o=_.value.find(s=>t?.path===s.label);o?.component&&(K.value=o)},{immediate:!0}),be(()=>S.value++),(t,o)=>(q(),P(J,null,[R(h(A),null,{default:$(({items:s,level:v})=>[(q(!0),P(J,null,xe(s,(u,m)=>(q(),P("li",{key:`${v}-${m}`,role:"presentation",class:E(v>1?r.value.itemWithChildren({class:e.ui?.itemWithChildren}):r.value.item({class:e.ui?.item}))},[R(h(Re),{level:v,value:u,"as-child":""},{default:$(({isExpanded:a,isSelected:d})=>[M("button",{type:"button",class:E(r.value.link({class:e.ui?.link,active:d}))},[u.children?.length?(q(),D(Z,{key:0,name:a?h(l).ui.icons.folderOpen:h(l).ui.icons.folder,class:E(r.value.linkLeadingIcon({class:e.ui?.linkLeadingIcon}))},null,8,["name","class"])):(q(),D(Ke,{key:1,filename:u.label,class:E(r.value.linkLeadingIcon({class:e.ui?.linkLeadingIcon}))},null,8,["filename","class"])),M("span",{class:E(r.value.linkLabel({class:e.ui?.linkLabel}))},Ce(u.label),3),u.children?.length?(q(),P("span",{key:2,class:E(r.value.linkTrailing({class:e.ui?.linkTrailing}))},[R(Z,{name:h(l).ui.icons.chevronDown,class:E(r.value.linkTrailingIcon({class:e.ui?.linkTrailingIcon}))},null,8,["name","class"])],2)):Q("",!0)],2),u.children?.length&&a?(q(),P("ul",{key:0,role:"group",class:E(r.value.listWithChildren({class:e.ui?.listWithChildren}))},[R(h(T),{items:u.children,level:v+1},null,8,["items","level"])],2)):Q("",!0)]),_:2},1032,["level","value"])],2))),128))]),_:1}),M("div",ne(t.$attrs,{class:r.value.root({class:[e.ui?.root,e.class]})}),[R(h(Ee),{modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=s=>k.value=s),expanded:i.value,"onUpdate:expanded":o[1]||(o[1]=s=>i.value=s),class:E(r.value.list({class:e.ui?.list})),items:B.value,"get-key":s=>s.path},{default:$(()=>[R(h(T),{items:B.value,level:1},null,8,["items"])]),_:1},8,["modelValue","expanded","class","items","get-key"]),M("div",{class:E(r.value.content({class:e.ui?.content}))},[(q(),D(ke(K.value?.component)))],2)],16)],64))}});export{De as default};
